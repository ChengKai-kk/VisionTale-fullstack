# 项目概览

## VisionTale 是什么
VisionTale 是一个多步骤的 AI 故事书生成工具。用户通过拍照或上传图片获得卡通头像，通过语音对话逐步收集故事需求，然后自动生成故事、拆分场景、生成插图，最终可以预览故事书或生成视频片段。

## 核心目的
- 降低故事创作门槛，用尽量少的输入完成一本故事书
- 用统一 session 贯穿各步骤，避免跨页面状态难同步
- 通过 task 轮询机制让前端在生成过程中持续更新进度

## 技术栈
- 前端: Vue 3, Vite, Vue Router (SPA)
- 后端: Node.js 原生 http 服务
- 外部服务: Volc Ark (LLM/图像/视频), Volc Speech ASR, DashScope TTS
- 存储: 纯内存 session/task store (无持久化)

## 关键特性
- 头像生成: 上传/拍照后进行漫画风格化
- 语音对话: ASR + LLM 多轮对话收集 storyReq
- 故事生成: 结构化 JSON 输出
- 场景拆分: 生成 sceneTitle/sceneText/imagePrompt/narration
- 插图生成: 逐场景生成，支持断点续跑
- 故事书预览: 翻页与打印导出 PDF
- 视频生成: I2V 逐场景生成视频片段

## 项目结构
```
.
├── visiontale_backend/
│   ├── server.js
│   └── src/
│       ├── router.js
│       ├── common/http.js
│       ├── session/
│       ├── task/
│       ├── avatar/
│       ├── voice/
│       ├── story/
│       ├── image/
│       ├── video/
│       └── upload/
└── visiontale_front/
    ├── index.html
    ├── package.json
    └── src/
        ├── main.js
        ├── App.vue
        ├── router/index.js
        ├── layouts/
        ├── components/
        ├── pages/
        └── styles/global.css
```

## 快速开始

### 后端
```
cd visiontale_backend
npm install
npm start
```

常用环境变量 (实际以运行环境为准):
- `ARK_API_KEY`, `ARK_BASE_URL`, `ARK_LLM_MODEL`, `ARK_IMAGE_MODEL`, `ARK_VIDEO_MODEL`
- `VOLC_SPEECH_APP_ID`, `VOLC_SPEECH_ACCESS_KEY`, `ASR_RESOURCE_ID`
- `DASHSCOPE_API_KEY` (TTS)
- `SESSION_TTL_MS`

### 前端
```
cd visiontale_front
npm install
npm run dev
```

可在 `visiontale_front/.env.local` 配置:
- `VITE_API_BASE` (后端地址)
- `VITE_API_TOKEN` (可选, 当前后端未做校验)

## 架构摘要
- 前端以路由步骤组织流程, 每步调用对应 API
- 后端基于 session/artifacts 存储流程状态, task 用于长任务进度
- 生成相关的外部调用都集中在后端 services/providers
